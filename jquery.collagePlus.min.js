/*!
 *
 * jQuery collagePlus Plugin v0.3.3
 * https://github.com/ed-lea/jquery-collagePlus
 *
 * Copyright 2012, Ed Lea twitter.com/ed_lea
 *
 * built for http://qiip.me
 *
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 *
 */
;!function(a){a.fn.collagePlus=function(b){function c(b,c,e,f){for(var g=e.padding*(b.length-1)+b.length*b[0][3],h=e.albumWidth-g,i=h/(c-g),j=g,k=c<e.albumWidth?!0:!1,l=0;l<b.length;l++){var m=a(b[l][0]),n=Math.floor(b[l][1]*i),o=Math.floor(b[l][2]*i),p=!!(l<b.length-1);e.allowPartialLastRow===!0&&k===!0&&(n=b[l][1],o=b[l][2]),j+=n,!p&&j<e.albumWidth&&(e.allowPartialLastRow===!0&&k===!0?n=n:n+=e.albumWidth-j),n--;var q=m.is("img")?m:m.find("img");q.width(n),m.is("img")||m.width(n+b[l][3]),q.height(o),m.is("img")||m.height(o+b[l][4]),d(m,p,e),q.one("loadc",function(a){return function(){if("default"==e.effect)a.animate({opacity:"1"},{duration:e.fadeSpeed});else{if("vertical"==e.direction)var b=10>=f?f:10;else var b=9>=l?l+1:10;a.removeClass(function(a,b){return(b.match(/\beffect-\S+/g)||[]).join(" ")}),a.addClass(e.effect),a.addClass("effect-duration-"+b)}}}(m)).each(function(){this.complete?a(this).trigger("loadc"):a(this).one("load",function(){a(this).trigger("loadc")})})}}function d(a,b,c){var d={"margin-bottom":c.padding+"px","margin-right":b?c.padding+"px":"0px",display:c.display,"vertical-align":"bottom",overflow:"hidden"};return a.css(d)}function e(b){$img=a(b);var c=new Array;return c.w=parseFloat($img.css("border-left-width"))+parseFloat($img.css("border-right-width")),c.h=parseFloat($img.css("border-top-width"))+parseFloat($img.css("border-bottom-width")),c}return this.each(function(){var d=0,f=[],g=1,h=a(this);a.fn.collagePlus.defaults.albumWidth=h.width(),a.fn.collagePlus.defaults.padding=parseFloat(h.css("padding-left")),a.fn.collagePlus.defaults.images=h.children();var i=a.extend({},a.fn.collagePlus.defaults,b);i.images.each(function(b){var h=a(this),j=h.is("img")?h:a(this).find("img"),k="undefined"!=typeof j.data("width")?j.data("width"):j.width(),l="undefined"!=typeof j.data("height")?j.data("height"):j.height(),m=e(j);j.data("width",k),j.data("height",l);var n=Math.ceil(k/l*i.targetHeight),o=Math.ceil(i.targetHeight);f.push([this,n,o,m.w,m.h]),d+=n+m.w+i.padding,d>i.albumWidth&&0!=f.length&&(c(f,d-i.padding,i,g),delete d,delete f,d=0,f=[],g+=1),i.images.length-1==b&&0!=f.length&&(c(f,d,i,g),delete d,delete f,d=0,f=[],g+=1)})})},a.fn.collagePlus.defaults={targetHeight:400,fadeSpeed:"fast",display:"inline-block",effect:"default",direction:"vertical",allowPartialLastRow:!1}}(jQuery);